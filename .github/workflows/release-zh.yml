name: æ„å»ºå¹¶å‘å¸ƒä¸­æ–‡ç‰ˆ

on:
  push:
    tags:
      - "v*-zh"  # ä¾‹å¦‚: v2.36.1-zh
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

env:
  PLUGIN_NAME: obsidian-git-zh

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ“¦ è®¾ç½® pnpm
        uses: pnpm/action-setup@v2
        with:
          version: latest

      - name: ğŸ”§ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'pnpm'

      - name: ğŸ“š å®‰è£…ä¾èµ–
        run: pnpm install

      - name: ğŸ”¨ æ„å»ºé¡¹ç›®
        run: |
          echo "ğŸ”¨ å¼€å§‹æ„å»º Obsidian Git ä¸­æ–‡ç‰ˆ..."
          pnpm run build
          echo "âœ… æ„å»ºå®Œæˆï¼"

      - name: ğŸ“Š æ˜¾ç¤ºæ„å»ºä¿¡æ¯
        run: |
          echo "ğŸ“¦ æ„å»ºæ–‡ä»¶:"
          ls -lh dist/
          echo ""
          echo "ğŸ“ æ–‡ä»¶å¤§å°:"
          du -h dist/*

      - name: ğŸ“¦ åˆ›å»ºå‘å¸ƒåŒ…
        run: |
          cd dist
          zip -r ../obsidian-git-zh-${{ github.ref_name }}.zip *
          cd ..
          echo "âœ… å·²åˆ›å»º ZIP åŒ…"

      - name: ğŸš€ åˆ›å»º GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          name: Obsidian Git ä¸­æ–‡ç‰ˆ ${{ github.ref_name }}
          body: |
            ## ğŸŒ Obsidian Git æ’ä»¶ä¸­æ–‡ç‰ˆ
            
            ### âœ¨ ä¸»è¦ç‰¹æ€§
            - ğŸ‡¨ğŸ‡³ **å®Œæ•´ä¸­æ–‡ç•Œé¢** - æ‰€æœ‰å‘½ä»¤ã€è®¾ç½®ã€é€šçŸ¥å‡å·²ç¿»è¯‘
            - ğŸŒ **æ™ºèƒ½è¯­è¨€åˆ‡æ¢** - æ”¯æŒä¸­è‹±æ–‡è‡ªç”±åˆ‡æ¢
            - ğŸ“– **ä¸­æ–‡æ–‡æ¡£** - å®Œæ•´çš„ä¸­æ–‡ä½¿ç”¨æŒ‡å—
            
            ### ğŸ“¦ å®‰è£…æ–¹æ³•
            
            **æ–¹å¼ä¸€ï¼šä¸‹è½½ ZIP åŒ…ï¼ˆæ¨èï¼‰**
            1. ä¸‹è½½ `obsidian-git-zh-${{ github.ref_name }}.zip`
            2. è§£å‹åˆ° `ä½ çš„ç¬”è®°åº“/.obsidian/plugins/obsidian-git-zh/`
            3. åœ¨ Obsidian è®¾ç½®ä¸­å¯ç”¨æ’ä»¶
            4. é€‰æ‹©è¯­è¨€ä¸º"ç®€ä½“ä¸­æ–‡"
            
            **æ–¹å¼äºŒï¼šä¸‹è½½å•ä¸ªæ–‡ä»¶**
            1. ä¸‹è½½ `main.js`ã€`manifest.json`ã€`styles.css`
            2. å¤åˆ¶åˆ° `ä½ çš„ç¬”è®°åº“/.obsidian/plugins/obsidian-git-zh/`
            3. åœ¨ Obsidian è®¾ç½®ä¸­å¯ç”¨æ’ä»¶
            
            è¯¦ç»†å®‰è£…è¯´æ˜è¯·æŸ¥çœ‹ [INSTALL.md](https://github.com/lyl224459/obsidian-git-zh/blob/master/INSTALL.md)
            
            ### ğŸ“Š ç‰ˆæœ¬ä¿¡æ¯
            - åŸºäºåŸç‰ˆ: v2.36.1
            - ä¸­æ–‡ç‰ˆæœ¬: ${{ github.ref_name }}
            - æ„å»ºæ—¥æœŸ: ${{ github.event.head_commit.timestamp }}
            
            ### ğŸ”— ç›¸å…³é“¾æ¥
            - [ä½¿ç”¨æŒ‡å—](https://github.com/lyl224459/obsidian-git-zh/blob/master/CHINESE_VERSION.md)
            - [æ±‰åŒ–è¯´æ˜](https://github.com/lyl224459/obsidian-git-zh/blob/master/LOCALIZATION_CN.md)
            - [æ„å»ºæ–‡æ¡£](https://github.com/lyl224459/obsidian-git-zh/blob/master/BUILD.md)
          draft: false
          prerelease: false
          files: |
            dist/main.js
            dist/manifest.json
            dist/styles.css
            obsidian-git-zh-${{ github.ref_name }}.zip
