name: æ„å»ºå¹¶å‘å¸ƒä¸­æ–‡ç‰ˆ

on:
  push:
    tags:
      - "v*-zh"  # ä¾‹å¦‚: v2.36.1-zh
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

env:
  PLUGIN_NAME: obsidian-git-zh

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ“¦ è®¾ç½® pnpm
        uses: pnpm/action-setup@v2
        with:
          version: latest

      - name: ğŸ”§ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'pnpm'

      - name: ğŸ“š å®‰è£…ä¾èµ–
        run: pnpm install

      - name: ğŸ”¨ æ„å»ºé¡¹ç›®
        run: |
          echo "ğŸ”¨ å¼€å§‹æ„å»º Obsidian Git ä¸­æ–‡ç‰ˆ..."
          pnpm run build
          echo "âœ… æ„å»ºå®Œæˆï¼"

      - name: ğŸ“Š æ˜¾ç¤ºæ„å»ºä¿¡æ¯
        run: |
          echo "ğŸ“¦ æ„å»ºæ–‡ä»¶:"
          ls -lh dist/
          echo ""
          echo "ğŸ“ æ–‡ä»¶å¤§å°:"
          du -h dist/*

      - name: ğŸ“¦ åˆ›å»ºå‘å¸ƒåŒ…
        run: |
          echo "ğŸ“¦ ç”Ÿæˆç¬¦åˆObsidianæ ‡å‡†çš„å‘å¸ƒåŒ…..."
          pnpm run package:obsidian
          mv git-zh.zip obsidian-git-zh-${{ github.ref_name }}.zip
          echo "âœ… å·²åˆ›å»ºç¬¦åˆæ ‡å‡†çš„å‘å¸ƒåŒ…"

      - name: ğŸš€ åˆ›å»º GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          name: Obsidian Git ä¸­æ–‡ç‰ˆ ${{ github.ref_name }}
          body: |
            ## ğŸŒ Obsidian Git ä¸­æ–‡ç‰ˆ ${{ github.ref_name }}

            ### âœ¨ ä¸»è¦ç‰¹æ€§
            - ğŸ‡¨ğŸ‡³ **å®Œæ•´ä¸­æ–‡ç•Œé¢** - æ‰€æœ‰å‘½ä»¤ã€è®¾ç½®ã€é€šçŸ¥å‡å·²ç¿»è¯‘ (220+ ç¿»è¯‘é”®)
            - ğŸŒ **æ™ºèƒ½è¯­è¨€åˆ‡æ¢** - æ”¯æŒä¸­è‹±æ–‡è‡ªç”±åˆ‡æ¢
            - ğŸ”„ **è‡ªåŠ¨å¤‡ä»½åŒæ­¥** - å®šæ—¶è‡ªåŠ¨æäº¤å’ŒåŒæ­¥
            - ğŸ“Š **å¯è§†åŒ–ç®¡ç†** - æºä»£ç ç®¡ç†è§†å›¾ã€å†å²è®°å½•è§†å›¾ã€å·®å¼‚è§†å›¾
            - ğŸ‘¤ **è¡Œä½œè€…åŠŸèƒ½** - æŸ¥çœ‹æ¯ä¸€è¡Œä»£ç çš„æœ€åä¿®æ”¹è€…ä¿¡æ¯
            - ğŸ“± **ç§»åŠ¨ç«¯ä¼˜åŒ–** - ç§»åŠ¨è®¾å¤‡æ€§èƒ½ä¼˜åŒ–å’Œè§¦æ‘¸å‹å¥½ç•Œé¢

            ### ğŸ“¦ å®‰è£…æ–¹æ³•

            **æ¨èæ–¹å¼ï¼šä¸‹è½½å‘å¸ƒåŒ…**
            1. ä¸‹è½½ `obsidian-git-zh-${{ github.ref_name }}.zip`
            2. è§£å‹åˆ°æ‚¨çš„ Obsidian æ’ä»¶ç›®å½•ï¼š
               - Windows: `%APPDATA%\\Obsidian\\Plugins\\`
               - macOS: `~/Library/Application Support/obsidian/Plugins/`
               - Linux: `~/.config/obsidian/Plugins/`
            3. é‡å¯ Obsidianï¼Œåœ¨è®¾ç½®ä¸­å¯ç”¨ "Git ä¸­æ–‡ç‰ˆ" æ’ä»¶

            **æ‰‹åŠ¨å®‰è£…ï¼š**
            ä¸‹è½½å‘å¸ƒåŒ…ä¸­çš„ `git-zh` æ–‡ä»¶å¤¹ï¼Œå¤åˆ¶åˆ°æ’ä»¶ç›®å½•

            ### ğŸ“‹ æ’ä»¶ä¿¡æ¯
            - **æ’ä»¶ID**: `git-zh`
            - **ç‰ˆæœ¬**: ${{ github.ref_name }}
            - **åŸºäºåŸç‰ˆ**: v2.36.1
            - **æœ€ä½Obsidianç‰ˆæœ¬**: 0.15.0
            - **æ–‡ä»¶å¤§å°**: ~820 KB
            - **æ„å»ºæ—¥æœŸ**: ${{ github.event.head_commit.timestamp }}

            ### ğŸ”— ç›¸å…³é“¾æ¥
            - [ğŸ“– ä½¿ç”¨æŒ‡å—](https://github.com/lyl224459/obsidian-git-zh/blob/master/README.md)
            - [ğŸš€ å¿«é€Ÿå¼€å§‹](https://github.com/lyl224459/obsidian-git-zh/blob/master/docs/Getting%20Started.md)
            - [â“ å¸¸è§é—®é¢˜](https://github.com/lyl224459/obsidian-git-zh/blob/master/docs/Common%20issues.md)
            - [ğŸŒŸ åŸç‰ˆé¡¹ç›®](https://github.com/Vinzent03/obsidian-git)

            ---
            **ğŸ’ å¦‚æœè¿™ä¸ªæ’ä»¶å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·è€ƒè™‘ç»™é¡¹ç›®ç‚¹ä¸ª â­ Starï¼**
          draft: false
          prerelease: false
          files: |
            obsidian-git-zh-${{ github.ref_name }}.zip
